<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Scanner API Integration - Tenable, Qualys, and Rapid7 API usage for vulnerability data extraction and automation.">
    <title>API Integration | VM Docs</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
</head>
<body>
    <div class="reading-progress">
        <div class="reading-progress-bar"></div>
    </div>
    
    <button class="mobile-menu-toggle" aria-label="Toggle menu">‚ò∞</button>
    
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">üõ°Ô∏è</div>
                    <div class="sidebar-logo-text"><span>VM</span>DOCS</div>
                </a>
            </div>
                                    <nav class="sidebar-nav">
                <div class="nav-section collapsed" data-section="1">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìö</span>
                        <span>1. Fundamentals</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="1-1-introduction.html" class="nav-item">1.1 Introduction</a>
                        <a href="1-2-program-framework.html" class="nav-item">1.2 Program Framework</a>
                        <a href="1-3-scoring-systems.html" class="nav-item">1.3 Scoring Systems</a>
                        <a href="1-4-compliance.html" class="nav-item">1.4 Compliance</a>
                        <a href="1-5-metrics-kpis.html" class="nav-item">1.5 Metrics & KPIs</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="2">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîç</span>
                        <span>2. Scanning</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="2-1-scanner-types.html" class="nav-item">2.1 Scanner Types</a>
                        <a href="2-2-nessus.html" class="nav-item">2.2 Nessus</a>
                        <a href="2-3-qualys.html" class="nav-item">2.3 Qualys</a>
                        <a href="2-4-rapid7.html" class="nav-item">2.4 Rapid7</a>
                        <a href="2-5-defender.html" class="nav-item">2.5 Defender VM</a>
                        <a href="2-6-opensource.html" class="nav-item">2.6 Open Source</a>
                        <a href="2-7-best-practices.html" class="nav-item">2.7 Best Practices</a>
                        <a href="2-8-authenticated.html" class="nav-item">2.8 Authenticated</a>
                        <a href="2-9-cloud-container.html" class="nav-item">2.9 Cloud/Container</a>
                        <a href="2-10-webapp.html" class="nav-item">2.10 Web App</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="3">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üì¶</span>
                        <span>3. Asset Discovery</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="3-1-discovery-methods.html" class="nav-item">3.1 Discovery Methods</a>
                        <a href="3-2-inventory-management.html" class="nav-item">3.2 Inventory</a>
                        <a href="3-3-cmdb-integration.html" class="nav-item">3.3 CMDB Integration</a>
                        <a href="3-4-cloud-discovery.html" class="nav-item">3.4 Cloud Discovery</a>
                        <a href="3-5-shadow-it.html" class="nav-item">3.5 Shadow IT</a>
                        <a href="3-6-classification.html" class="nav-item">3.6 Classification</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="4">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üéØ</span>
                        <span>4. Analysis</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="4-1-prioritization.html" class="nav-item">4.1 Prioritization</a>
                        <a href="4-2-risk-scoring.html" class="nav-item">4.2 Risk Scoring</a>
                        <a href="4-3-threat-intel.html" class="nav-item">4.3 Threat Intel</a>
                        <a href="4-4-exploit-prediction.html" class="nav-item">4.4 Exploit Prediction</a>
                        <a href="4-5-business-context.html" class="nav-item">4.5 Business Context</a>
                        <a href="4-6-exceptions.html" class="nav-item">4.6 Exceptions</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="5">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîß</span>
                        <span>5. Remediation</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="5-1-remediation-strategies.html" class="nav-item">5.1 Strategies</a>
                        <a href="5-2-patch-management.html" class="nav-item">5.2 Patch Mgmt</a>
                        <a href="5-3-change-management.html" class="nav-item">5.3 Change Mgmt</a>
                        <a href="5-4-ticket-workflows.html" class="nav-item">5.4 Ticket Workflows</a>
                        <a href="5-5-sla-management.html" class="nav-item">5.5 SLA Mgmt</a>
                        <a href="5-6-verification.html" class="nav-item">5.6 Verification</a>
                        <a href="5-7-rollback.html" class="nav-item">5.7 Rollback</a>
                        <a href="5-8-metrics.html" class="nav-item">5.8 Metrics</a>
                    </div>
                </div>
                
                <div class="nav-section " data-section="6">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">‚ö°</span>
                        <span>6. Automation</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="6-1-soar-integration.html" class="nav-item">6.1 SOAR</a>
                        <a href="6-2-ticketing-integration.html" class="nav-item">6.2 Ticketing</a>
                        <a href="6-3-api-integration.html" class="nav-item active">6.3 API Integration</a>
                        <a href="6-4-workflow-automation.html" class="nav-item">6.4 Workflows</a>
                        <a href="6-5-reporting-automation.html" class="nav-item">6.5 Report Automation</a>
                        <a href="6-6-notifications.html" class="nav-item">6.6 Notifications</a>
                        <a href="6-7-cicd-integration.html" class="nav-item">6.7 CI/CD</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="7">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêõ</span>
                        <span>7. Vuln Types</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="7-1-os-vulnerabilities.html" class="nav-item">7.1 OS Vulns</a>
                        <a href="7-2-application-vulns.html" class="nav-item">7.2 Applications</a>
                        <a href="7-3-network-device-vulns.html" class="nav-item">7.3 Network Devices</a>
                        <a href="7-4-web-application-vulns.html" class="nav-item">7.4 Web Apps</a>
                        <a href="7-5-container-vulns.html" class="nav-item">7.5 Containers</a>
                        <a href="7-6-cloud-vulns.html" class="nav-item">7.6 Cloud</a>
                        <a href="7-7-database-vulns.html" class="nav-item">7.7 Databases</a>
                        <a href="7-8-iot-ot-vulns.html" class="nav-item">7.8 IoT/OT</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="8">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìä</span>
                        <span>8. Reporting</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="8-1-dashboards.html" class="nav-item">8.1 Dashboards</a>
                        <a href="8-2-executive-reporting.html" class="nav-item">8.2 Executive</a>
                        <a href="8-3-operational-reporting.html" class="nav-item">8.3 Operational</a>
                        <a href="8-4-compliance-reporting.html" class="nav-item">8.4 Compliance</a>
                        <a href="8-5-kpis-metrics.html" class="nav-item">8.5 KPIs</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="9">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîå</span>
                        <span>9. Tools Deep Dive</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="9-1-splunk-vm.html" class="nav-item">9.1 Splunk</a>
                        <a href="9-2-sentinel-vm.html" class="nav-item">9.2 Sentinel</a>
                        <a href="9-3-cortex-xsoar.html" class="nav-item">9.3 XSOAR</a>
                        <a href="9-4-tenable.html" class="nav-item">9.4 Tenable</a>
                        <a href="9-5-qualys.html" class="nav-item">9.5 Qualys</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed0" data-section="10">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üéØ</span>
                        <span>10. Interview Prep</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="10-1-common-questions.html" class="nav-item">10.1 Common Questions</a>
                        <a href="10-2-scenario-questions.html" class="nav-item">10.2 Scenarios</a>
                        <a href="10-3-technical-deep-dive.html" class="nav-item">10.3 Technical</a>
                        <a href="10-4-study-guide.html" class="nav-item">10.4 Study Guide</a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <div class="content-wrapper">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <a href="6-1-soar-integration.html">Section 6: Automation</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-current">API Integration</span>
                </nav>
                
                <header class="page-header">
                    <h1>Scanner API Integration</h1>
                    <div class="page-meta">
                        <span class="page-meta-item">üìñ Section 6.3</span>
                        <span class="page-meta-item">‚è±Ô∏è 18 min read</span>
                    </div>
                </header>
                
                <div class="info-box overview" data-label="Overview">
                    <div class="info-box-title">üìò What You'll Learn</div>
                    <p>
                        This page covers API integration with major vulnerability scanners including 
                        Tenable.io, Qualys VMDR, and Rapid7 InsightVM for data extraction and automation.
                    </p>
                </div>
                
                <h2>Tenable.io API</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>üìã</span> Copy</button>
                    </div>
                    <pre><code>"""
Tenable.io API Integration
Extract vulnerability data and manage scans.
"""

from tenable.io import TenableIO
from typing import Dict, List, Generator
import json


class TenableVMClient:
    """Tenable.io vulnerability management client."""
    
    def __init__(self, access_key: str, secret_key: str):
        self.tio = TenableIO(access_key, secret_key)
    
    def get_vulnerabilities(self, severity: List[str] = None,
                            age_days: int = None) -> Generator[Dict, None, None]:
        """
        Export vulnerability data.
        
        Args:
            severity: Filter by severity ['critical', 'high', 'medium', 'low']
            age_days: Only vulns found in last N days
        
        Yields:
            Vulnerability records
        """
        filters = []
        
        if severity:
            filters.append(('severity', 'eq', severity))
        
        if age_days:
            filters.append(('first_found', 'date-gt', f'-{age_days}'))
        
        # Use export API for large datasets
        vulns = self.tio.exports.vulns(
            severity=severity,
            state=['open', 'reopened']
        )
        
        for vuln in vulns:
            yield {
                'plugin_id': vuln.get('plugin', {}).get('id'),
                'plugin_name': vuln.get('plugin', {}).get('name'),
                'cve_id': vuln.get('plugin', {}).get('cve', [None])[0],
                'cvss_score': vuln.get('plugin', {}).get('cvss_base_score'),
                'vpr_score': vuln.get('plugin', {}).get('vpr', {}).get('score'),
                'severity': vuln.get('severity'),
                'asset_uuid': vuln.get('asset', {}).get('uuid'),
                'hostname': vuln.get('asset', {}).get('hostname'),
                'ip_address': vuln.get('asset', {}).get('ipv4'),
                'first_found': vuln.get('first_found'),
                'last_found': vuln.get('last_found'),
                'state': vuln.get('state'),
                'solution': vuln.get('plugin', {}).get('solution'),
                'description': vuln.get('plugin', {}).get('description')
            }
    
    def get_assets(self, has_vulns: bool = True) -> Generator[Dict, None, None]:
        """Export asset inventory."""
        
        assets = self.tio.exports.assets()
        
        for asset in assets:
            if has_vulns and asset.get('severities', []):
                yield {
                    'uuid': asset.get('id'),
                    'hostname': asset.get('hostname', [''])[0],
                    'fqdn': asset.get('fqdn', [''])[0],
                    'ip_addresses': asset.get('ipv4', []),
                    'mac_addresses': asset.get('mac_address', []),
                    'os': asset.get('operating_system', [''])[0],
                    'last_scan': asset.get('last_authenticated_scan_date'),
                    'severities': asset.get('severities', []),
                    'tags': asset.get('tags', [])
                }
    
    def launch_scan(self, scan_id: int) -> str:
        """Launch an existing scan."""
        result = self.tio.scans.launch(scan_id)
        return result.get('scan_uuid')
    
    def get_scan_status(self, scan_uuid: str) -> str:
        """Get scan execution status."""
        scan = self.tio.scans.status(scan_uuid)
        return scan.get('status')
    
    def create_tag(self, category: str, value: str) -> str:
        """Create asset tag for grouping."""
        tag = self.tio.tags.create(category, value)
        return tag.get('uuid')
    
    def tag_assets(self, tag_uuid: str, asset_uuids: List[str]):
        """Apply tag to assets."""
        self.tio.tags.assign(asset_uuids, [tag_uuid])</code></pre>
                </div>
                
                <h2>Qualys VMDR API</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>üìã</span> Copy</button>
                    </div>
                    <pre><code>"""
Qualys VMDR API Integration
Extract vulnerability and asset data.
"""

import requests
from typing import Dict, List, Optional
import xml.etree.ElementTree as ET


class QualysVMDRClient:
    """Qualys VMDR API client."""
    
    def __init__(self, username: str, password: str, platform: str = 'qualysapi.qualys.com'):
        self.base_url = f"https://{platform}"
        self.auth = (username, password)
        self.headers = {'X-Requested-With': 'Python'}
    
    def get_host_detections(self, 
                            severities: List[int] = None,
                            qids: List[int] = None) -> List[Dict]:
        """
        Get host vulnerability detections.
        
        Args:
            severities: Filter by severity (1-5)
            qids: Filter by specific QID
        """
        params = {
            'action': 'list',
            'show_results': '1',
            'status': 'New,Active,Re-Opened'
        }
        
        if severities:
            params['severities'] = ','.join(map(str, severities))
        
        if qids:
            params['qids'] = ','.join(map(str, qids))
        
        response = requests.post(
            f"{self.base_url}/api/2.0/fo/asset/host/vm/detection/",
            auth=self.auth,
            headers=self.headers,
            data=params
        )
        response.raise_for_status()
        
        # Parse XML response
        root = ET.fromstring(response.text)
        
        detections = []
        for host in root.findall('.//HOST'):
            host_data = {
                'host_id': host.findtext('ID'),
                'ip': host.findtext('IP'),
                'hostname': host.findtext('DNS'),
                'os': host.findtext('OS'),
                'detections': []
            }
            
            for detection in host.findall('.//DETECTION'):
                host_data['detections'].append({
                    'qid': detection.findtext('QID'),
                    'type': detection.findtext('TYPE'),
                    'severity': detection.findtext('SEVERITY'),
                    'status': detection.findtext('STATUS'),
                    'first_found': detection.findtext('FIRST_FOUND_DATETIME'),
                    'last_found': detection.findtext('LAST_FOUND_DATETIME'),
                    'results': detection.findtext('RESULTS')
                })
            
            detections.append(host_data)
        
        return detections
    
    def get_vulnerability_details(self, qids: List[int]) -> List[Dict]:
        """Get vulnerability knowledge base details."""
        
        params = {
            'action': 'list',
            'ids': ','.join(map(str, qids)),
            'details': 'All'
        }
        
        response = requests.post(
            f"{self.base_url}/api/2.0/fo/knowledge_base/vuln/",
            auth=self.auth,
            headers=self.headers,
            data=params
        )
        response.raise_for_status()
        
        root = ET.fromstring(response.text)
        
        vulns = []
        for vuln in root.findall('.//VULN'):
            vulns.append({
                'qid': vuln.findtext('QID'),
                'title': vuln.findtext('TITLE'),
                'severity': vuln.findtext('SEVERITY_LEVEL'),
                'cvss_base': vuln.findtext('CVSS/BASE'),
                'cvss_temporal': vuln.findtext('CVSS_V3/TEMPORAL'),
                'cve_list': [cve.text for cve in vuln.findall('.//CVE/ID')],
                'solution': vuln.findtext('SOLUTION'),
                'consequence': vuln.findtext('CONSEQUENCE'),
                'patchable': vuln.findtext('PATCHABLE') == '1'
            })
        
        return vulns
    
    def launch_scan(self, scan_ref: str) -> str:
        """Launch a scan."""
        params = {
            'action': 'launch',
            'scan_ref': scan_ref
        }
        
        response = requests.post(
            f"{self.base_url}/api/2.0/fo/scan/",
            auth=self.auth,
            headers=self.headers,
            data=params
        )
        response.raise_for_status()
        
        return response.text</code></pre>
                </div>
                
                <h2>Rapid7 InsightVM API</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>üìã</span> Copy</button>
                    </div>
                    <pre><code>"""
Rapid7 InsightVM API Integration
"""

import requests
from typing import Dict, List, Optional


class InsightVMClient:
    """Rapid7 InsightVM API client."""
    
    def __init__(self, host: str, username: str, password: str):
        self.base_url = f"https://{host}:3780/api/3"
        self.auth = (username, password)
        self.headers = {'Accept': 'application/json'}
    
    def get_vulnerabilities(self, page: int = 0, 
                            size: int = 100) -> Dict:
        """Get vulnerability listing with pagination."""
        
        response = requests.get(
            f"{self.base_url}/vulnerabilities",
            auth=self.auth,
            headers=self.headers,
            params={'page': page, 'size': size},
            verify=False  # Self-signed cert common
        )
        response.raise_for_status()
        
        return response.json()
    
    def get_vulnerability_details(self, vuln_id: str) -> Dict:
        """Get detailed vulnerability information."""
        
        response = requests.get(
            f"{self.base_url}/vulnerabilities/{vuln_id}",
            auth=self.auth,
            headers=self.headers,
            verify=False
        )
        response.raise_for_status()
        
        return response.json()
    
    def get_asset_vulnerabilities(self, asset_id: int) -> List[Dict]:
        """Get vulnerabilities for specific asset."""
        
        response = requests.get(
            f"{self.base_url}/assets/{asset_id}/vulnerabilities",
            auth=self.auth,
            headers=self.headers,
            verify=False
        )
        response.raise_for_status()
        
        return response.json().get('resources', [])
    
    def get_assets(self, page: int = 0, size: int = 100) -> Dict:
        """Get asset listing."""
        
        response = requests.get(
            f"{self.base_url}/assets",
            auth=self.auth,
            headers=self.headers,
            params={'page': page, 'size': size},
            verify=False
        )
        response.raise_for_status()
        
        return response.json()
    
    def search_assets(self, filters: List[Dict]) -> Dict:
        """Search assets with filters."""
        
        payload = {'filters': filters}
        
        response = requests.post(
            f"{self.base_url}/assets/search",
            auth=self.auth,
            headers={**self.headers, 'Content-Type': 'application/json'},
            json=payload,
            verify=False
        )
        response.raise_for_status()
        
        return response.json()
    
    def start_scan(self, site_id: int, targets: List[str] = None) -> int:
        """Start ad-hoc scan."""
        
        payload = {}
        if targets:
            payload['hosts'] = targets
        
        response = requests.post(
            f"{self.base_url}/sites/{site_id}/scans",
            auth=self.auth,
            headers={**self.headers, 'Content-Type': 'application/json'},
            json=payload,
            verify=False
        )
        response.raise_for_status()
        
        return response.json().get('id')</code></pre>
                </div>
                
                <div class="info-box interview" data-label="Interview">
                    <div class="info-box-title">üí° Interview Question</div>
                    <p>
                        <strong>"How do you use scanner APIs for automation?"</strong><br><br>
                        Sample answer: "I use scanner APIs for several automation use cases: extracting 
                        vulnerability data for custom dashboards and reporting, triggering on-demand scans 
                        after patch deployments for verification, synchronizing asset tags with CMDB for 
                        ownership assignment, and feeding data into our SIEM for correlation. For Tenable.io, 
                        I use the exports API for bulk data extraction since it handles pagination efficiently. 
                        I typically run scheduled scripts that pull new findings and push them to our 
                        ticketing system."
                    </p>
                </div>
                
                <h2>Summary</h2>
                
                <p>
                    Scanner APIs enable powerful automation beyond the native UI. Use them for bulk 
                    data extraction, custom reporting, integration with other tools, and on-demand 
                    scanning. Each platform has different API patterns‚Äîunderstand pagination, rate 
                    limits, and authentication methods.
                </p>
                
                <nav class="page-navigation">
                    <a href="6-2-ticketing-integration.html" class="page-nav-link prev">
                        <span class="page-nav-label">‚Üê Previous</span>
                        <span class="page-nav-title">Ticketing Integration</span>
                    </a>
                    <a href="6-4-workflow-automation.html" class="page-nav-link next">
                        <span class="page-nav-label">Next ‚Üí</span>
                        <span class="page-nav-title">Workflow Automation</span>
                    </a>
                </nav>
            </div>
        </main>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
