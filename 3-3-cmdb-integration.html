<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="CMDB Integration - ServiceNow integration, bidirectional sync, data reconciliation, and CI enrichment for vulnerability management.">
    <title>CMDB Integration | VM Docs</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›¡ï¸</text></svg>">
</head>
<body>
    <div class="reading-progress">
        <div class="reading-progress-bar"></div>
    </div>
    
    <button class="mobile-menu-toggle" aria-label="Toggle menu">â˜°</button>
    
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">ğŸ›¡ï¸</div>
                    <div class="sidebar-logo-text"><span>VM</span>DOCS</div>
                </a>
            </div>
                                    <nav class="sidebar-nav">
                <div class="nav-section collapsed" data-section="1">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“š</span>
                        <span>1. Fundamentals</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="1-1-introduction.html" class="nav-item">1.1 Introduction</a>
                        <a href="1-2-program-framework.html" class="nav-item">1.2 Program Framework</a>
                        <a href="1-3-scoring-systems.html" class="nav-item">1.3 Scoring Systems</a>
                        <a href="1-4-compliance.html" class="nav-item">1.4 Compliance</a>
                        <a href="1-5-metrics-kpis.html" class="nav-item">1.5 Metrics & KPIs</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="2">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”</span>
                        <span>2. Scanning</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="2-1-scanner-types.html" class="nav-item">2.1 Scanner Types</a>
                        <a href="2-2-nessus.html" class="nav-item">2.2 Nessus</a>
                        <a href="2-3-qualys.html" class="nav-item">2.3 Qualys</a>
                        <a href="2-4-rapid7.html" class="nav-item">2.4 Rapid7</a>
                        <a href="2-5-defender.html" class="nav-item">2.5 Defender VM</a>
                        <a href="2-6-opensource.html" class="nav-item">2.6 Open Source</a>
                        <a href="2-7-best-practices.html" class="nav-item">2.7 Best Practices</a>
                        <a href="2-8-authenticated.html" class="nav-item">2.8 Authenticated</a>
                        <a href="2-9-cloud-container.html" class="nav-item">2.9 Cloud/Container</a>
                        <a href="2-10-webapp.html" class="nav-item">2.10 Web App</a>
                    </div>
                </div>
                
                <div class="nav-section " data-section="3">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“¦</span>
                        <span>3. Asset Discovery</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="3-1-discovery-methods.html" class="nav-item">3.1 Discovery Methods</a>
                        <a href="3-2-inventory-management.html" class="nav-item">3.2 Inventory</a>
                        <a href="3-3-cmdb-integration.html" class="nav-item active">3.3 CMDB Integration</a>
                        <a href="3-4-cloud-discovery.html" class="nav-item">3.4 Cloud Discovery</a>
                        <a href="3-5-shadow-it.html" class="nav-item">3.5 Shadow IT</a>
                        <a href="3-6-classification.html" class="nav-item">3.6 Classification</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="4">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ¯</span>
                        <span>4. Analysis</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="4-1-prioritization.html" class="nav-item">4.1 Prioritization</a>
                        <a href="4-2-risk-scoring.html" class="nav-item">4.2 Risk Scoring</a>
                        <a href="4-3-threat-intel.html" class="nav-item">4.3 Threat Intel</a>
                        <a href="4-4-exploit-prediction.html" class="nav-item">4.4 Exploit Prediction</a>
                        <a href="4-5-business-context.html" class="nav-item">4.5 Business Context</a>
                        <a href="4-6-exceptions.html" class="nav-item">4.6 Exceptions</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="5">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”§</span>
                        <span>5. Remediation</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="5-1-remediation-strategies.html" class="nav-item">5.1 Strategies</a>
                        <a href="5-2-patch-management.html" class="nav-item">5.2 Patch Mgmt</a>
                        <a href="5-3-change-management.html" class="nav-item">5.3 Change Mgmt</a>
                        <a href="5-4-ticket-workflows.html" class="nav-item">5.4 Ticket Workflows</a>
                        <a href="5-5-sla-management.html" class="nav-item">5.5 SLA Mgmt</a>
                        <a href="5-6-verification.html" class="nav-item">5.6 Verification</a>
                        <a href="5-7-rollback.html" class="nav-item">5.7 Rollback</a>
                        <a href="5-8-metrics.html" class="nav-item">5.8 Metrics</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="6">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">âš¡</span>
                        <span>6. Automation</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="6-1-soar-integration.html" class="nav-item">6.1 SOAR</a>
                        <a href="6-2-ticketing-integration.html" class="nav-item">6.2 Ticketing</a>
                        <a href="6-3-api-integration.html" class="nav-item">6.3 API Integration</a>
                        <a href="6-4-workflow-automation.html" class="nav-item">6.4 Workflows</a>
                        <a href="6-5-reporting-automation.html" class="nav-item">6.5 Report Automation</a>
                        <a href="6-6-notifications.html" class="nav-item">6.6 Notifications</a>
                        <a href="6-7-cicd-integration.html" class="nav-item">6.7 CI/CD</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="7">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ›</span>
                        <span>7. Vuln Types</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="7-1-os-vulnerabilities.html" class="nav-item">7.1 OS Vulns</a>
                        <a href="7-2-application-vulns.html" class="nav-item">7.2 Applications</a>
                        <a href="7-3-network-device-vulns.html" class="nav-item">7.3 Network Devices</a>
                        <a href="7-4-web-application-vulns.html" class="nav-item">7.4 Web Apps</a>
                        <a href="7-5-container-vulns.html" class="nav-item">7.5 Containers</a>
                        <a href="7-6-cloud-vulns.html" class="nav-item">7.6 Cloud</a>
                        <a href="7-7-database-vulns.html" class="nav-item">7.7 Databases</a>
                        <a href="7-8-iot-ot-vulns.html" class="nav-item">7.8 IoT/OT</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="8">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ“Š</span>
                        <span>8. Reporting</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="8-1-dashboards.html" class="nav-item">8.1 Dashboards</a>
                        <a href="8-2-executive-reporting.html" class="nav-item">8.2 Executive</a>
                        <a href="8-3-operational-reporting.html" class="nav-item">8.3 Operational</a>
                        <a href="8-4-compliance-reporting.html" class="nav-item">8.4 Compliance</a>
                        <a href="8-5-kpis-metrics.html" class="nav-item">8.5 KPIs</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed" data-section="9">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ”Œ</span>
                        <span>9. Tools Deep Dive</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="9-1-splunk-vm.html" class="nav-item">9.1 Splunk</a>
                        <a href="9-2-sentinel-vm.html" class="nav-item">9.2 Sentinel</a>
                        <a href="9-3-cortex-xsoar.html" class="nav-item">9.3 XSOAR</a>
                        <a href="9-4-tenable.html" class="nav-item">9.4 Tenable</a>
                        <a href="9-5-qualys.html" class="nav-item">9.5 Qualys</a>
                    </div>
                </div>
                
                <div class="nav-section collapsed0" data-section="10">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">ğŸ¯</span>
                        <span>10. Interview Prep</span>
                        <span class="nav-section-toggle">â–¼</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="10-1-common-questions.html" class="nav-item">10.1 Common Questions</a>
                        <a href="10-2-scenario-questions.html" class="nav-item">10.2 Scenarios</a>
                        <a href="10-3-technical-deep-dive.html" class="nav-item">10.3 Technical</a>
                        <a href="10-4-study-guide.html" class="nav-item">10.4 Study Guide</a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <div class="content-wrapper">
                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">â€º</span>
                    <a href="3-1-discovery-methods.html">Section 3: Asset Discovery</a>
                    <span class="breadcrumb-separator">â€º</span>
                    <span class="breadcrumb-current">CMDB Integration</span>
                </nav>
                
                <header class="page-header">
                    <h1>CMDB Integration</h1>
                    <div class="page-meta">
                        <span class="page-meta-item">ğŸ“– Section 3.3</span>
                        <span class="page-meta-item">â±ï¸ 18 min read</span>
                    </div>
                </header>
                
                <div class="info-box overview" data-label="Overview">
                    <div class="info-box-title">ğŸ“˜ What You'll Learn</div>
                    <p>
                        This page covers integrating vulnerability management with Configuration Management 
                        Databases (CMDB), specifically ServiceNow integration patterns, bidirectional sync, 
                        data reconciliation, and enriching vulnerability data with business context.
                    </p>
                </div>
                
                <h2>Why CMDB Integration Matters</h2>
                
                <p>
                    The CMDB is often the authoritative source for business context: asset ownership, 
                    criticality, environment, and application relationships. Integrating VM with CMDB 
                    enables prioritization based on business impact rather than just technical severity.
                </p>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Text</span>
                        <button class="code-block-copy"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <pre><code>CMDB INTEGRATION BENEFITS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VULNERABILITY SCANNER                       CMDB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€
â€¢ IP Address                          â†â”€â”€â”€  â€¢ Asset Owner
â€¢ Hostname                                  â€¢ Business Unit
â€¢ OS Version                                â€¢ Environment (Prod/Dev)
â€¢ Vulnerabilities                           â€¢ Criticality Tier
â€¢ Last Scan Date                            â€¢ Application
                                           â€¢ Compliance Scope
                                           â€¢ Location
                                           â€¢ Support Group

COMBINED VALUE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Route tickets to correct owner automatically
â€¢ Prioritize by business criticality, not just CVSS
â€¢ Filter reports by business unit or application
â€¢ Identify gaps: assets in scanner but not CMDB
â€¢ Track coverage: what % of CMDB assets are scanned?</code></pre>
                </div>
                
                <h2>ServiceNow Integration</h2>
                
                <h3>REST API Integration</h3>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <pre><code>"""
ServiceNow CMDB Integration for Vulnerability Management
"""

import requests
from typing import Dict, List, Optional
from base64 import b64encode


class ServiceNowCMDB:
    """ServiceNow CMDB API client."""
    
    def __init__(self, instance: str, username: str, password: str):
        """
        Initialize ServiceNow client.
        
        Args:
            instance: ServiceNow instance name (e.g., 'company')
            username: API username
            password: API password
        """
        self.base_url = f'https://{instance}.service-now.com/api/now'
        self.auth = (username, password)
        self.headers = {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        }
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # CI (Configuration Item) Operations
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def get_ci_by_ip(self, ip_address: str) -> Optional[Dict]:
        """Look up CI by IP address."""
        response = requests.get(
            f'{self.base_url}/table/cmdb_ci',
            auth=self.auth,
            headers=self.headers,
            params={
                'sysparm_query': f'ip_address={ip_address}',
                'sysparm_limit': 1
            }
        )
        response.raise_for_status()
        results = response.json().get('result', [])
        return results[0] if results else None
    
    def get_ci_by_hostname(self, hostname: str) -> Optional[Dict]:
        """Look up CI by hostname."""
        response = requests.get(
            f'{self.base_url}/table/cmdb_ci',
            auth=self.auth,
            headers=self.headers,
            params={
                'sysparm_query': f'nameLIKE{hostname}',
                'sysparm_limit': 1
            }
        )
        response.raise_for_status()
        results = response.json().get('result', [])
        return results[0] if results else None
    
    def get_servers(self, query: str = None) -> List[Dict]:
        """Get server CIs from CMDB."""
        params = {
            'sysparm_query': query or 'sys_class_name=cmdb_ci_server',
            'sysparm_fields': 'sys_id,name,ip_address,os,assigned_to,department,'
                             'operational_status,environment,business_criticality',
            'sysparm_limit': 1000
        }
        
        response = requests.get(
            f'{self.base_url}/table/cmdb_ci_server',
            auth=self.auth,
            headers=self.headers,
            params=params
        )
        response.raise_for_status()
        return response.json().get('result', [])
    
    def enrich_asset(self, scanner_asset: Dict) -> Dict:
        """
        Enrich scanner asset with CMDB data.
        
        Args:
            scanner_asset: Asset from vulnerability scanner
            
        Returns:
            Enriched asset with CMDB fields
        """
        enriched = scanner_asset.copy()
        
        # Try to find matching CI
        ci = None
        if scanner_asset.get('ip'):
            ci = self.get_ci_by_ip(scanner_asset['ip'])
        
        if not ci and scanner_asset.get('hostname'):
            ci = self.get_ci_by_hostname(scanner_asset['hostname'])
        
        if ci:
            enriched['cmdb_sys_id'] = ci.get('sys_id')
            enriched['cmdb_matched'] = True
            enriched['owner'] = ci.get('assigned_to', {}).get('display_value')
            enriched['department'] = ci.get('department', {}).get('display_value')
            enriched['environment'] = ci.get('environment')
            enriched['criticality'] = ci.get('business_criticality')
            enriched['operational_status'] = ci.get('operational_status')
        else:
            enriched['cmdb_matched'] = False
            enriched['owner'] = 'Unassigned'
        
        return enriched
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Vulnerability Integration (VR Module)
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def create_vulnerable_item(self, ci_sys_id: str, vulnerability: Dict) -> str:
        """
        Create a Vulnerable Item in ServiceNow VR module.
        
        Args:
            ci_sys_id: CMDB CI sys_id
            vulnerability: Vulnerability data from scanner
            
        Returns:
            sys_id of created record
        """
        payload = {
            'cmdb_ci': ci_sys_id,
            'vulnerability': vulnerability.get('cve_id'),
            'source': vulnerability.get('scanner', 'External Scanner'),
            'severity': self._map_severity(vulnerability.get('severity')),
            'state': 'Open',
            'short_description': vulnerability.get('title'),
            'description': vulnerability.get('description'),
            'solution': vulnerability.get('solution')
        }
        
        response = requests.post(
            f'{self.base_url}/table/sn_vul_vulnerable_item',
            auth=self.auth,
            headers=self.headers,
            json=payload
        )
        response.raise_for_status()
        return response.json()['result']['sys_id']
    
    def _map_severity(self, severity: str) -> str:
        """Map scanner severity to ServiceNow values."""
        mapping = {
            'Critical': '1',
            'High': '2',
            'Medium': '3',
            'Low': '4',
            'Info': '5'
        }
        return mapping.get(severity, '3')
    
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Incident Creation for Vulnerabilities
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    def create_vuln_incident(self, ci_sys_id: str, vulnerability: Dict, 
                             assignment_group: str) -> str:
        """Create an incident for a critical vulnerability."""
        payload = {
            'short_description': f"Critical Vulnerability: {vulnerability.get('cve_id')}",
            'description': f"""
Critical vulnerability detected requiring immediate remediation.

CVE: {vulnerability.get('cve_id')}
CVSS Score: {vulnerability.get('cvss_score')}
Affected Asset: {vulnerability.get('hostname')} ({vulnerability.get('ip')})

Description:
{vulnerability.get('description')}

Remediation:
{vulnerability.get('solution')}
            """,
            'cmdb_ci': ci_sys_id,
            'category': 'Security',
            'subcategory': 'Vulnerability',
            'impact': '2',
            'urgency': '1',
            'priority': '1',
            'assignment_group': assignment_group
        }
        
        response = requests.post(
            f'{self.base_url}/table/incident',
            auth=self.auth,
            headers=self.headers,
            json=payload
        )
        response.raise_for_status()
        return response.json()['result']['number']


# Example Usage
if __name__ == '__main__':
    snow = ServiceNowCMDB('mycompany', 'api_user', 'api_password')
    
    # Enrich scanner asset with CMDB data
    scanner_asset = {
        'ip': '192.168.1.10',
        'hostname': 'web-server-01',
        'vulnerabilities': 15
    }
    
    enriched = snow.enrich_asset(scanner_asset)
    print(f"Owner: {enriched.get('owner')}")
    print(f"Criticality: {enriched.get('criticality')}")
    print(f"CMDB Match: {enriched.get('cmdb_matched')}")</code></pre>
                </div>
                
                <h2>Bidirectional Sync</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Text</span>
                        <button class="code-block-copy"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <pre><code>BIDIRECTIONAL CMDB SYNC ARCHITECTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     VULNERABILITY SCANNER                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Asset Inventory    â”‚    Vulnerability Data                 â”‚   â”‚
â”‚  â”‚  â€¢ IP, Hostname     â”‚    â€¢ CVE findings                     â”‚   â”‚
â”‚  â”‚  â€¢ OS, Software     â”‚    â€¢ Severity, CVSS                   â”‚   â”‚
â”‚  â”‚  â€¢ Last scan date   â”‚    â€¢ Remediation status               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                         â”‚
              â”‚  Assets      Vulns      â”‚
              â–¼             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      INTEGRATION LAYER            â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  â€¢ Asset matching           â”‚  â”‚
        â”‚  â”‚  â€¢ Data transformation      â”‚  â”‚
        â”‚  â”‚  â€¢ Conflict resolution      â”‚  â”‚
        â”‚  â”‚  â€¢ Sync scheduling          â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                           â”‚
              â–¼ Push CI updates    Pull context
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVICENOW CMDB                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Configuration Items   â”‚   Business Context                 â”‚   â”‚
â”‚  â”‚  â€¢ Servers, devices    â”‚   â€¢ Owner, department              â”‚   â”‚
â”‚  â”‚  â€¢ Relationships       â”‚   â€¢ Criticality                    â”‚   â”‚
â”‚  â”‚  â€¢ Operational status  â”‚   â€¢ Environment, location          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SYNC DIRECTIONS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
CMDB â†’ Scanner (Pull):
  â€¢ Owner/assigned_to
  â€¢ Business criticality
  â€¢ Environment classification
  â€¢ Department/cost center
  â€¢ Compliance scope flags
  â€¢ Application relationships

Scanner â†’ CMDB (Push):
  â€¢ Last scan date
  â€¢ Vulnerability count
  â€¢ Software inventory updates
  â€¢ OS version corrections
  â€¢ New asset discovery (creates CI proposals)</code></pre>
                </div>
                
                <h2>Data Reconciliation</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>ğŸ“‹</span> Copy</button>
                    </div>
                    <pre><code>"""
CMDB Data Reconciliation
Compare scanner inventory with CMDB and identify discrepancies.
"""

from typing import Dict, List, Tuple
from dataclasses import dataclass
from enum import Enum


class DiscrepancyType(Enum):
    MISSING_IN_CMDB = "Asset in scanner but not in CMDB"
    MISSING_IN_SCANNER = "Asset in CMDB but not scanned"
    DATA_MISMATCH = "Data differs between sources"
    STALE_CMDB = "CMDB data outdated"


@dataclass
class Discrepancy:
    asset_id: str
    hostname: str
    discrepancy_type: DiscrepancyType
    field: str
    scanner_value: str
    cmdb_value: str
    recommendation: str


class CMDBReconciler:
    """Reconcile scanner inventory with CMDB."""
    
    def __init__(self):
        self.discrepancies = []
    
    def reconcile(self, scanner_assets: List[Dict], 
                  cmdb_assets: List[Dict]) -> List[Discrepancy]:
        """
        Compare scanner and CMDB inventories.
        
        Returns list of discrepancies.
        """
        self.discrepancies = []
        
        # Index assets by IP and hostname for matching
        scanner_by_ip = {a.get('ip'): a for a in scanner_assets if a.get('ip')}
        scanner_by_host = {a.get('hostname', '').lower(): a for a in scanner_assets}
        
        cmdb_by_ip = {a.get('ip_address'): a for a in cmdb_assets if a.get('ip_address')}
        cmdb_by_host = {a.get('name', '').lower(): a for a in cmdb_assets}
        
        # Find assets in scanner but not in CMDB
        for ip, scanner_asset in scanner_by_ip.items():
            if ip not in cmdb_by_ip:
                hostname = scanner_asset.get('hostname', 'unknown')
                if hostname.lower() not in cmdb_by_host:
                    self.discrepancies.append(Discrepancy(
                        asset_id=ip,
                        hostname=hostname,
                        discrepancy_type=DiscrepancyType.MISSING_IN_CMDB,
                        field='existence',
                        scanner_value='Present',
                        cmdb_value='Missing',
                        recommendation='Create CI in CMDB or investigate shadow IT'
                    ))
        
        # Find assets in CMDB but not scanned
        for ip, cmdb_asset in cmdb_by_ip.items():
            if ip not in scanner_by_ip:
                hostname = cmdb_asset.get('name', 'unknown')
                status = cmdb_asset.get('operational_status', 'unknown')
                
                # Only flag if marked as operational
                if status.lower() in ['operational', 'active', '1']:
                    self.discrepancies.append(Discrepancy(
                        asset_id=ip,
                        hostname=hostname,
                        discrepancy_type=DiscrepancyType.MISSING_IN_SCANNER,
                        field='scan_coverage',
                        scanner_value='Not scanned',
                        cmdb_value=f'Status: {status}',
                        recommendation='Add to scan scope or update CMDB status'
                    ))
        
        # Compare matching assets for data mismatches
        for ip, scanner_asset in scanner_by_ip.items():
            if ip in cmdb_by_ip:
                cmdb_asset = cmdb_by_ip[ip]
                self._compare_assets(scanner_asset, cmdb_asset)
        
        return self.discrepancies
    
    def _compare_assets(self, scanner: Dict, cmdb: Dict):
        """Compare individual asset records."""
        ip = scanner.get('ip')
        hostname = scanner.get('hostname', cmdb.get('name', 'unknown'))
        
        # Compare OS
        scanner_os = scanner.get('os_name', '').lower()
        cmdb_os = cmdb.get('os', '').lower()
        
        if scanner_os and cmdb_os:
            if not self._os_matches(scanner_os, cmdb_os):
                self.discrepancies.append(Discrepancy(
                    asset_id=ip,
                    hostname=hostname,
                    discrepancy_type=DiscrepancyType.DATA_MISMATCH,
                    field='operating_system',
                    scanner_value=scanner.get('os_name'),
                    cmdb_value=cmdb.get('os'),
                    recommendation='Update CMDB with current OS from scanner'
                ))
        
        # Compare hostname
        scanner_host = scanner.get('hostname', '').lower()
        cmdb_host = cmdb.get('name', '').lower()
        
        if scanner_host and cmdb_host and scanner_host != cmdb_host:
            self.discrepancies.append(Discrepancy(
                asset_id=ip,
                hostname=hostname,
                discrepancy_type=DiscrepancyType.DATA_MISMATCH,
                field='hostname',
                scanner_value=scanner.get('hostname'),
                cmdb_value=cmdb.get('name'),
                recommendation='Verify correct hostname in both systems'
            ))
    
    def _os_matches(self, scanner_os: str, cmdb_os: str) -> bool:
        """Fuzzy OS comparison."""
        # Normalize common variations
        scanner_os = scanner_os.replace('microsoft ', '').replace('red hat ', 'rhel ')
        cmdb_os = cmdb_os.replace('microsoft ', '').replace('red hat ', 'rhel ')
        
        # Check if one contains the other
        return scanner_os in cmdb_os or cmdb_os in scanner_os
    
    def generate_report(self) -> Dict:
        """Generate reconciliation summary report."""
        summary = {
            'total_discrepancies': len(self.discrepancies),
            'by_type': {},
            'discrepancies': []
        }
        
        for disc in self.discrepancies:
            type_name = disc.discrepancy_type.value
            summary['by_type'][type_name] = summary['by_type'].get(type_name, 0) + 1
            summary['discrepancies'].append({
                'asset': disc.hostname,
                'ip': disc.asset_id,
                'type': type_name,
                'field': disc.field,
                'recommendation': disc.recommendation
            })
        
        return summary


# Example
reconciler = CMDBReconciler()

scanner_assets = [
    {'ip': '192.168.1.10', 'hostname': 'web-01', 'os_name': 'Windows Server 2019'},
    {'ip': '192.168.1.11', 'hostname': 'web-02', 'os_name': 'Ubuntu 22.04'},
    {'ip': '192.168.1.99', 'hostname': 'shadow-server', 'os_name': 'CentOS 7'},
]

cmdb_assets = [
    {'ip_address': '192.168.1.10', 'name': 'WEB-01', 'os': 'Windows Server 2016', 
     'operational_status': 'Operational'},
    {'ip_address': '192.168.1.11', 'name': 'web-02', 'os': 'Ubuntu 22.04',
     'operational_status': 'Operational'},
    {'ip_address': '192.168.1.20', 'name': 'db-01', 'os': 'Oracle Linux',
     'operational_status': 'Operational'},
]

discrepancies = reconciler.reconcile(scanner_assets, cmdb_assets)
report = reconciler.generate_report()
print(f"Found {report['total_discrepancies']} discrepancies")</code></pre>
                </div>
                
                <div class="info-box interview" data-label="Interview">
                    <div class="info-box-title">ğŸ’¡ Interview Question</div>
                    <p>
                        <strong>"How do you integrate vulnerability scanning with ServiceNow?"</strong><br><br>
                        Sample answer: "I implement bidirectional integration: pulling business context like 
                        owner, criticality, and application from CMDB to enrich vulnerability data, and pushing 
                        scan results back to create vulnerable items or incidents. I use the ServiceNow REST API 
                        for custom integrations or native connectors from tools like Qualys or Tenable. Key 
                        design decisions include matching logic (IP vs hostname vs serial), handling unmatched 
                        assets, and automation rules for ticket creation. I also run regular reconciliation to 
                        identify coverage gaps."
                    </p>
                </div>
                
                <h2>Summary</h2>
                
                <p>
                    CMDB integration enriches vulnerability data with business context, enabling smarter 
                    prioritization and automated workflows. Bidirectional sync keeps both systems current, 
                    and regular reconciliation identifies coverage gaps and data quality issues.
                </p>
                
                <nav class="page-navigation">
                    <a href="3-2-inventory-management.html" class="page-nav-link prev">
                        <span class="page-nav-label">â† Previous</span>
                        <span class="page-nav-title">Inventory Management</span>
                    </a>
                    <a href="3-4-cloud-discovery.html" class="page-nav-link next">
                        <span class="page-nav-label">Next â†’</span>
                        <span class="page-nav-title">Cloud Asset Discovery</span>
                    </a>
                </nav>
            </div>
        </main>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
