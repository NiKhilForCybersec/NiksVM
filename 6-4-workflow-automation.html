<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Workflow Automation - Automated vulnerability processing workflows using Python, scheduled jobs, and orchestration.">
    <title>Workflow Automation | VM Docs</title>
    <link rel="stylesheet" href="main.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
</head>
<body>
    <div class="reading-progress">
        <div class="reading-progress-bar"></div>
    </div>
    
    <button class="mobile-menu-toggle" aria-label="Toggle menu">‚ò∞</button>
    
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">üõ°Ô∏è</div>
                    <div class="sidebar-logo-text"><span>VM</span>DOCS</div>
                </a>
            </div>
                                    <nav class="sidebar-nav">
                <div class="nav-section collapsed" data-section="1">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìö</span>
                        <span>1. Fundamentals</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="1-1-introduction.html" class="nav-item">1.1 Introduction</a>
                        <a href="1-2-program-framework.html" class="nav-item">1.2 Framework</a>
                        <a href="1-3-scoring-systems.html" class="nav-item">1.3 Scoring</a>
                        <a href="1-4-compliance.html" class="nav-item">1.4 Compliance</a>
                        <a href="1-5-metrics-kpis.html" class="nav-item">1.5 Metrics</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="2">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîç</span>
                        <span>2. Scanning</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="2-1-scanner-types.html" class="nav-item">2.1 Scanner Types</a>
                        <a href="2-2-nessus.html" class="nav-item">2.2 Nessus</a>
                        <a href="2-3-qualys.html" class="nav-item">2.3 Qualys</a>
                        <a href="2-4-rapid7.html" class="nav-item">2.4 Rapid7</a>
                        <a href="2-5-defender.html" class="nav-item">2.5 Defender</a>
                        <a href="2-6-opensource.html" class="nav-item">2.6 Open Source</a>
                        <a href="2-7-best-practices.html" class="nav-item">2.7 Best Practices</a>
                        <a href="2-8-authenticated.html" class="nav-item">2.8 Authenticated</a>
                        <a href="2-9-cloud-container.html" class="nav-item">2.9 Cloud/Container</a>
                        <a href="2-10-webapp.html" class="nav-item">2.10 Web App</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="3">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üì¶</span>
                        <span>3. Assets</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="3-1-discovery-methods.html" class="nav-item">3.1 Discovery</a>
                        <a href="3-2-inventory-management.html" class="nav-item">3.2 Inventory</a>
                        <a href="3-3-cmdb-integration.html" class="nav-item">3.3 CMDB</a>
                        <a href="3-4-cloud-discovery.html" class="nav-item">3.4 Cloud</a>
                        <a href="3-5-shadow-it.html" class="nav-item">3.5 Shadow IT</a>
                        <a href="3-6-classification.html" class="nav-item">3.6 Classification</a>
                        <a href="3-7-attack-surface.html" class="nav-item">3.7 Attack Surface</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="4">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üéØ</span>
                        <span>4. Analysis</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="4-1-prioritization.html" class="nav-item">4.1 Prioritization</a>
                        <a href="4-2-risk-scoring.html" class="nav-item">4.2 Risk Scoring</a>
                        <a href="4-3-threat-intel.html" class="nav-item">4.3 Threat Intel</a>
                        <a href="4-4-exploit-prediction.html" class="nav-item">4.4 EPSS</a>
                        <a href="4-5-business-context.html" class="nav-item">4.5 Business Context</a>
                        <a href="4-6-exceptions.html" class="nav-item">4.6 Exceptions</a>
                        <a href="4-7-risk-acceptance.html" class="nav-item">4.7 Risk Acceptance</a>
                        <a href="4-8-zero-day-response.html" class="nav-item">4.8 Zero-Day</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="5">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîß</span>
                        <span>5. Remediation</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="5-1-remediation-strategies.html" class="nav-item">5.1 Strategies</a>
                        <a href="5-2-patch-management.html" class="nav-item">5.2 Patching</a>
                        <a href="5-3-change-management.html" class="nav-item">5.3 Change Mgmt</a>
                        <a href="5-4-ticket-workflows.html" class="nav-item">5.4 Tickets</a>
                        <a href="5-5-sla-management.html" class="nav-item">5.5 SLAs</a>
                        <a href="5-6-verification.html" class="nav-item">5.6 Verification</a>
                        <a href="5-7-rollback.html" class="nav-item">5.7 Rollback</a>
                        <a href="5-8-metrics.html" class="nav-item">5.8 Metrics</a>
                        <a href="5-9-compensating-controls.html" class="nav-item">5.9 Compensating</a>
                    </div>
                </div>
                <div class="nav-section" data-section="6">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">‚ö°</span>
                        <span>6. Automation</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="6-1-soar-integration.html" class="nav-item">6.1 SOAR</a>
                        <a href="6-2-ticketing-integration.html" class="nav-item">6.2 Ticketing</a>
                        <a href="6-3-api-integration.html" class="nav-item">6.3 APIs</a>
                        <a href="6-4-workflow-automation.html" class="nav-item active">6.4 Workflows</a>
                        <a href="6-5-reporting-automation.html" class="nav-item">6.5 Reports</a>
                        <a href="6-6-notifications.html" class="nav-item">6.6 Alerts</a>
                        <a href="6-7-cicd-integration.html" class="nav-item">6.7 CI/CD</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="7">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üêõ</span>
                        <span>7. Vuln Types</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="7-1-os-vulnerabilities.html" class="nav-item">7.1 OS</a>
                        <a href="7-2-application-vulns.html" class="nav-item">7.2 Apps</a>
                        <a href="7-3-network-device-vulns.html" class="nav-item">7.3 Network</a>
                        <a href="7-4-web-application-vulns.html" class="nav-item">7.4 Web</a>
                        <a href="7-5-container-vulns.html" class="nav-item">7.5 Containers</a>
                        <a href="7-6-cloud-vulns.html" class="nav-item">7.6 Cloud</a>
                        <a href="7-7-database-vulns.html" class="nav-item">7.7 Database</a>
                        <a href="7-8-iot-ot-vulns.html" class="nav-item">7.8 IoT/OT</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="8">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üìä</span>
                        <span>8. Reporting</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="8-1-dashboards.html" class="nav-item">8.1 Dashboards</a>
                        <a href="8-2-executive-reporting.html" class="nav-item">8.2 Executive</a>
                        <a href="8-3-operational-reporting.html" class="nav-item">8.3 Operational</a>
                        <a href="8-4-compliance-reporting.html" class="nav-item">8.4 Compliance</a>
                        <a href="8-5-kpis-metrics.html" class="nav-item">8.5 KPIs</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="9">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üîå</span>
                        <span>9. Tools</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="9-1-splunk-vm.html" class="nav-item">9.1 Splunk</a>
                        <a href="9-2-sentinel-vm.html" class="nav-item">9.2 Sentinel</a>
                        <a href="9-3-cortex-xsoar.html" class="nav-item">9.3 XSOAR</a>
                        <a href="9-4-tenable.html" class="nav-item">9.4 Tenable</a>
                        <a href="9-5-qualys.html" class="nav-item">9.5 Qualys</a>
                    </div>
                </div>
                <div class="nav-section collapsed" data-section="10">
                    <div class="nav-section-header">
                        <span class="nav-section-icon">üéì</span>
                        <span>10. Interview</span>
                        <span class="nav-section-toggle">‚ñº</span>
                    </div>
                    <div class="nav-section-items">
                        <a href="10-1-common-questions.html" class="nav-item">10.1 Q&A</a>
                        <a href="10-2-scenario-questions.html" class="nav-item">10.2 Scenarios</a>
                        <a href="10-3-technical-deep-dive.html" class="nav-item">10.3 Technical</a>
                        <a href="10-4-study-guide.html" class="nav-item">10.4 Study Guide</a>
                        <a href="10-5-interview-scenarios.html" class="nav-item">10.5 Deep Dives</a>
                    </div>
                </div>
            </nav>
        </aside>
        
        <main class="main-content">
            <div class="content-wrapper">

                <div class="memory-box">
                    <div class="memory-box-title">üß† What to Automate</div>
                    <p>
                        ‚úì Ticket creation for new vulns<br>
                        ‚úì Asset enrichment (owner lookup)<br>
                        ‚úì SLA breach notifications<br>
                        ‚úì Verification scan scheduling<br>
                        ‚úì Report generation & distribution
                    </p>
                </div>

                <nav class="breadcrumb">
                    <a href="index.html">Home</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <a href="6-1-soar-integration.html">Section 6: Automation</a>
                    <span class="breadcrumb-separator">‚Ä∫</span>
                    <span class="breadcrumb-current">Workflow Automation</span>
                </nav>
                
                <header class="page-header">
                    <h1>Workflow Automation</h1>
                    <div class="page-meta">
                        <span class="page-meta-item">üìñ Section 6.4</span>
                        <span class="page-meta-item">‚è±Ô∏è 14 min read</span>
                    </div>
                </header>
                
                <div class="info-box overview" data-label="Overview">
                    <div class="info-box-title">üìò What You'll Learn</div>
                    <p>
                        This page covers building automated vulnerability management workflows including 
                        scheduled processing, enrichment pipelines, and end-to-end automation.
                    </p>
                </div>
                
                <h2>Daily Processing Workflow</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>üìã</span> Copy</button>
                    </div>
                    <pre><code>"""
Daily Vulnerability Processing Workflow
Automated pipeline for new vulnerability handling.
"""

import logging
from datetime import datetime, timedelta
from typing import Dict, List

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


class VulnerabilityWorkflow:
    """Orchestrate daily vulnerability processing."""
    
    def __init__(self, scanner, enricher, ticketing, notifier):
        self.scanner = scanner
        self.enricher = enricher
        self.ticketing = ticketing
        self.notifier = notifier
    
    def run_daily_workflow(self):
        """Execute daily vulnerability processing."""
        logger.info("Starting daily vulnerability workflow")
        
        # Step 1: Extract new vulnerabilities
        new_vulns = self.extract_new_vulnerabilities()
        logger.info(f"Found {len(new_vulns)} new vulnerabilities")
        
        # Step 2: Enrich with threat intelligence
        enriched_vulns = self.enrich_vulnerabilities(new_vulns)
        
        # Step 3: Prioritize
        prioritized = self.prioritize_vulnerabilities(enriched_vulns)
        
        # Step 4: Create/update tickets
        tickets_created = self.create_tickets(prioritized)
        logger.info(f"Created {tickets_created} tickets")
        
        # Step 5: Send notifications
        self.send_notifications(prioritized)
        
        # Step 6: Update metrics
        self.update_metrics(prioritized, tickets_created)
        
        logger.info("Daily workflow completed")
    
    def extract_new_vulnerabilities(self) -> List[Dict]:
        """Get vulnerabilities found since last run."""
        yesterday = datetime.now() - timedelta(days=1)
        
        vulns = list(self.scanner.get_vulnerabilities(
            severity=['critical', 'high'],
            age_days=1
        ))
        
        return vulns
    
    def enrich_vulnerabilities(self, vulns: List[Dict]) -> List[Dict]:
        """Add threat intelligence to vulnerabilities."""
        enriched = []
        
        for vuln in vulns:
            cve = vuln.get('cve_id')
            if cve:
                # Add CISA KEV status
                vuln['cisa_kev'] = self.enricher.check_kev(cve)
                
                # Add EPSS score
                vuln['epss'] = self.enricher.get_epss(cve)
                
                # Add exploit availability
                vuln['exploit_available'] = self.enricher.check_exploits(cve)
            
            # Add asset context
            asset_id = vuln.get('asset_uuid')
            if asset_id:
                asset_info = self.enricher.get_asset_context(asset_id)
                vuln['asset_criticality'] = asset_info.get('criticality', 3)
                vuln['asset_owner'] = asset_info.get('owner')
            
            enriched.append(vuln)
        
        return enriched
    
    def prioritize_vulnerabilities(self, vulns: List[Dict]) -> List[Dict]:
        """Calculate priority for each vulnerability."""
        for vuln in vulns:
            score = 0
            
            # CVSS contribution
            cvss = vuln.get('cvss_score', 5.0)
            score += (cvss / 10) * 30
            
            # EPSS contribution
            epss = vuln.get('epss', 0.01)
            if epss > 0.1:
                score += 25
            elif epss > 0.01:
                score += 10
            
            # KEV boost
            if vuln.get('cisa_kev'):
                score += 30
            
            # Asset criticality
            criticality = vuln.get('asset_criticality', 3)
            score *= {1: 1.5, 2: 1.2, 3: 1.0, 4: 0.8}.get(criticality, 1.0)
            
            # Assign priority
            if score >= 80 or vuln.get('cisa_kev'):
                vuln['priority'] = 'P1'
            elif score >= 60:
                vuln['priority'] = 'P2'
            elif score >= 40:
                vuln['priority'] = 'P3'
            else:
                vuln['priority'] = 'P4'
            
            vuln['risk_score'] = round(score, 1)
        
        # Sort by score descending
        vulns.sort(key=lambda x: x['risk_score'], reverse=True)
        
        return vulns
    
    def create_tickets(self, vulns: List[Dict]) -> int:
        """Create tickets for prioritized vulnerabilities."""
        # Group by CVE + owner
        from collections import defaultdict
        grouped = defaultdict(list)
        
        for vuln in vulns:
            key = (vuln.get('cve_id'), vuln.get('asset_owner', 'Unassigned'))
            grouped[key].append(vuln)
        
        created = 0
        for (cve, owner), items in grouped.items():
            # Check if ticket already exists
            existing = self.ticketing.find_ticket(cve=cve, owner=owner)
            
            if existing:
                # Update existing ticket with new assets
                self.ticketing.update_ticket(existing, items)
            else:
                # Create new ticket
                self.ticketing.create_ticket(items[0], items)
                created += 1
        
        return created
    
    def send_notifications(self, vulns: List[Dict]):
        """Send notifications for critical findings."""
        # P1 vulnerabilities get immediate notification
        p1_vulns = [v for v in vulns if v.get('priority') == 'P1']
        
        if p1_vulns:
            self.notifier.send_critical_alert(p1_vulns)
        
        # KEV additions get special notification
        kev_vulns = [v for v in vulns if v.get('cisa_kev')]
        if kev_vulns:
            self.notifier.send_kev_alert(kev_vulns)
    
    def update_metrics(self, vulns: List[Dict], tickets: int):
        """Update daily metrics."""
        metrics = {
            'date': datetime.now().isoformat(),
            'new_vulns': len(vulns),
            'p1_count': sum(1 for v in vulns if v.get('priority') == 'P1'),
            'p2_count': sum(1 for v in vulns if v.get('priority') == 'P2'),
            'kev_count': sum(1 for v in vulns if v.get('cisa_kev')),
            'tickets_created': tickets
        }
        
        logger.info(f"Daily metrics: {metrics}")</code></pre>
                </div>
                
                <h2>Scheduled Jobs</h2>
                
                <div class="code-block">
                    <div class="code-block-header">
                        <span class="code-block-lang">Python</span>
                        <button class="code-block-copy"><span>üìã</span> Copy</button>
                    </div>
                    <pre><code># Schedule with APScheduler
from apscheduler.schedulers.blocking import BlockingScheduler
from apscheduler.triggers.cron import CronTrigger

scheduler = BlockingScheduler()

# Daily vulnerability processing - 6 AM
scheduler.add_job(
    workflow.run_daily_workflow,
    CronTrigger(hour=6, minute=0),
    id='daily_vuln_processing'
)

# Hourly KEV check for new additions
scheduler.add_job(
    workflow.check_kev_updates,
    CronTrigger(hour='*', minute=15),
    id='hourly_kev_check'
)

# Weekly SLA compliance report - Monday 8 AM
scheduler.add_job(
    reports.generate_sla_report,
    CronTrigger(day_of_week='mon', hour=8),
    id='weekly_sla_report'
)

scheduler.start()</code></pre>
                </div>
                
                <div class="info-box interview" data-label="Interview">
                    <div class="info-box-title">üí° Interview Question</div>
                    <p>
                        <strong>"Walk me through an automated vulnerability workflow you've built."</strong><br><br>
                        Sample answer: "I built a daily automated workflow that runs at 6 AM. It extracts 
                        new vulnerabilities from Tenable.io, enriches them with CISA KEV status and EPSS 
                        scores, calculates risk-based priority, groups findings by CVE and owner, creates 
                        Jira tickets for new findings or updates existing ones, and sends Slack notifications 
                        for P1 vulnerabilities. I also run an hourly check for new KEV additions since those 
                        require immediate attention. The whole pipeline reduces manual triage from hours to 
                        minutes of review time."
                    </p>
                </div>
                
                <h2>Summary</h2>
                
                <p>
                    Workflow automation transforms VM from reactive to proactive. Build pipelines that 
                    extract, enrich, prioritize, and action vulnerabilities automatically. Focus human 
                    attention on exceptions and complex decisions rather than routine processing.
                </p>
                
                <nav class="page-navigation">
                    <a href="6-3-api-integration.html" class="page-nav-link prev">
                        <span class="page-nav-label">‚Üê Previous</span>
                        <span class="page-nav-title">API Integration</span>
                    </a>
                    <a href="6-5-reporting-automation.html" class="page-nav-link next">
                        <span class="page-nav-label">Next ‚Üí</span>
                        <span class="page-nav-title">Reporting Automation</span>
                    </a>
                </nav>
            </div>
        </main>
    </div>
    
    <script src="main.js"></script>
</body>
</html>
